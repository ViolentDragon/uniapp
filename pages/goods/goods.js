"use strict";const e=require("../../common/vendor.js"),o=require("../../services/goods.js"),r=require("../../services/cart.js");require("../../stores/index.js");const s=require("../../stores/modules/address.js");if(require("../../utils/http.js"),require("../../stores/modules/member.js"),!Array){(e.resolveComponent("vk-data-goods-sku-popup")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../components/vk-data-goods-sku-popup/vk-data-goods-sku-popup.js")+u+a+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup.js"))();const u=()=>"./components/AddressPanel.js",a=()=>"./components/ServicePanel.js",l=e.defineComponent({__name:"goods",props:{id:null},setup(u){const a=u,{safeAreaInsets:l}=e.index.getSystemInfoSync(),n=e.ref(),t=e.ref(0),d=e.ref(),i=e.ref({}),c=e.ref(1),v=e=>{y.value=!0,c.value=e},p=e.ref(),m=e.computed((()=>{var e,o;return(null==(o=null==(e=p.value)?void 0:e.selectArr)?void 0:o.join(" ").trim())||"请选择商品规格"})),g=async o=>{await r.postShoppingCartService({skuId:o._id,count:o.buy_num}),e.index.showToast({title:"添加成功",icon:"success"}),y.value=!1},f=s.userAddressStore(),b=async o=>{var r;console.log(o),e.index.navigateTo({url:`/pagesOrder/order/order?skuId=${o._id}&count=${o.buy_num}&addressId=${null==(r=f.selectAddress)?void 0:r.id}`})},k=e=>{t.value=e.detail.current},_=e.ref(),j=e=>{var o;_.value=e,null==(o=d.value)||o.open()},y=e.ref(!1);return e.onLoad((()=>{(async()=>{const e=await o.getGoodsService(a.id);n.value=e.result,i.value={_id:e.result.id,name:e.result.name,goods_thumb:e.result.mainPictures[0],spec_list:e.result.specs.map((e=>({name:e.name,list:e.values}))),sku_list:e.result.skus.map((o=>({_id:o.id,goods_id:e.result.id,goods_name:e.result.name,image:o.picture,price:100*o.price,stock:o.inventory,sku_name_arr:o.specs.map((e=>e.valueName))})))}})()})),(o,r)=>{var s,u,a,f,A,q,x,P,h;return e.e({a:e.sr(p,"0cb4687a-0",{k:"skuRef"}),b:e.o(g),c:e.o(b),d:e.o((e=>y.value=e)),e:e.p({mode:c.value,localdata:i.value,"add-cart-background-color":"#feac63","buy-now-background-color":"#1aaa9b","actived-style":{color:"#27BA9B",borderColor:"#27BA9B",backgroundColor:"#E9f8F5"},modelValue:y.value}),f:e.f(null==(s=n.value)?void 0:s.mainPictures,((o,r,s)=>({a:o,b:o,c:e.o((r=>{return s=o,void e.index.previewImage({current:s,urls:n.value.mainPictures});var s}),o)}))),g:e.o(k),h:e.t(t.value+1),i:e.t(null==(u=n.value)?void 0:u.mainPictures.length),j:e.t(null==(a=n.value)?void 0:a.price),k:e.t(null==(f=n.value)?void 0:f.name),l:e.t(null==(A=n.value)?void 0:A.desc),m:e.t(e.unref(m)),n:e.o((e=>v(1))),o:e.o((e=>j("address"))),p:e.o((e=>j("service"))),q:e.f(null==(q=n.value)?void 0:q.details.properties,((o,r,s)=>({a:e.t(o.name),b:e.t(o.value),c:o.name}))),r:e.f(null==(x=n.value)?void 0:x.details.pictures,((e,o,r)=>({a:e,b:e}))),s:e.f(null==(P=n.value)?void 0:P.similarProducts,((o,r,s)=>({a:o.picture,b:e.t(o.name),c:e.t(o.price),d:o.id,e:`/pages/goods/goods?id=${o.id}`}))),t:e.o((e=>v(2))),v:e.o((e=>v(3))),w:(null==(h=e.unref(l))?void 0:h.bottom)+"px",x:"address"===_.value},"address"===_.value?{y:e.o((e=>{var o;return null==(o=d.value)?void 0:o.close()}))}:{},{z:"service"===_.value},"service"===_.value?{A:e.o((e=>{var o;return null==(o=d.value)?void 0:o.close()}))}:{},{B:e.sr(d,"0cb4687a-1",{k:"popup"}),C:e.p({type:"bottom","background-color":"#fff"})})}}});wx.createPage(l);
