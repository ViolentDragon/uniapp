"use strict";const e=require("../../common/vendor.js"),r=require("../../composables/index.js"),t=require("../../services/order.js"),a=require("../../services/constants.js"),o=require("../../services/pay.js");if(require("../../utils/http.js"),require("../../stores/index.js"),require("../../stores/modules/member.js"),require("../../stores/modules/address.js"),!Array){(e.resolveComponent("uni-countdown")+e.resolveComponent("XtxGuess")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-countdown/uni-countdown.js")+(()=>"../../components/XtxGuess.js")+u+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup.js"))();const u=()=>"./components/PageSkeleton.js",n=e.defineComponent({__name:"detaile",props:{id:null},setup(u){const n=u,{safeAreaInsets:l}=e.index.getSystemInfoSync(),{guessRef:i,onScrolltolower:s}=r.useGetGuessList(),d=e.ref(),c=e.ref(["商品无货","不想要了","商品信息填错了","地址信息填写错误","商品降价","其它"]),f=e.ref(""),v=getCurrentPages(),S=v.at(-1);e.onReady((()=>{S.animate(".navbar",[{backgroundColor:"transparent"},{backgroundColor:"#f8f8f8"}],1e3,{scrollSource:"#scroller",timeRange:1e3,startScrollOffset:0,endScrollOffset:50}),S.animate(".navbar .title",[{color:"transparent"},{color:"#000"}],1e3,{scrollSource:"#scroller",timeRange:1e3,startScrollOffset:0,endScrollOffset:50}),S.animate(".navbar .back",[{color:"#fff"},{color:"#000"}],1e3,{scrollSource:"#scroller",timeRange:1e3,startScrollOffset:0,endScrollOffset:50})}));const p=e.ref(),m=async()=>{const e=await t.getMemberOrderByIdService(n.id);p.value=e.result,[a.OrderState.DaiPingJia,a.OrderState.YiWanCheng,a.OrderState.DaiShouHuo].includes(p.value.orderState)&&O()},g=e.ref([]),O=async()=>{const e=await t.getMemberOrderLogisticsByIdService(n.id);g.value=e.result.list},y=e.ref(!1);e.onLoad((async()=>{y.value=!0,await Promise.all([m()]),y.value=!1}));const b=()=>{p.value.orderState=a.OrderState.YiQuXiao},x=async()=>{{const r=await o.getPayWxPayMiniPayService({orderId:n.id});e.wx$1.requestPayment(r.result)}e.index.redirectTo({url:`/pagesOrder/payment/payment?id=${n.id}`})},w=async()=>{},D=()=>{e.index.showModal({content:"为保障您的权益，请收到货并确认无误后，再确认收货",showCancel:!0,success:async({confirm:e,cancel:r})=>{if(e){const e=await t.putMemberOrderReceiptByIdService(n.id);p.value=e.result}}})},h=()=>{e.index.showModal({content:"是否删除订单？",showCancel:!0,success:async({confirm:r,cancel:a})=>{r&&(await t.deleteMemberOrderService({ids:[n.id]}),e.index.redirectTo({url:"/pagesOrder/list/list"}))}})};return(r,t)=>{var o,u,S,m,O;return e.e({a:e.unref(v).length>0},(e.unref(v).length,{}),{b:(null==(o=e.unref(l))?void 0:o.top)+"px",c:p.value},p.value?e.e({d:(null==(u=p.value)?void 0:u.orderState)===e.unref(a.OrderState).DaiFuKuan},(null==(S=p.value)?void 0:S.orderState)===e.unref(a.OrderState).DaiFuKuan?{e:e.o(b),f:e.p({second:p.value.countdown,"show-day":!1,"show-colon":!1,color:"#fff","splitor-color":"#fff"}),g:e.o(x)}:e.e({h:e.t(e.unref(a.orderStateList)[p.value.orderState].text),i:`/pagesOrder/order/order?orderId=${n.id}`,j:e.unref(false)&&p.value.orderState===e.unref(a.OrderState).DaiFaHuo},e.unref(false)&&p.value.orderState===e.unref(a.OrderState).DaiFaHuo?{k:e.o(w)}:{},{l:p.value.orderState===e.unref(a.OrderState).DaiShouHuo},p.value.orderState===e.unref(a.OrderState).DaiShouHuo?{m:e.o(D)}:{}),{n:e.unref(l).top+20+"px",o:e.f(g.value,((r,t,a)=>({a:e.t(r.text),b:e.t(r.time),c:r.id}))),p:e.t(p.value.receiverContact),q:e.t(p.value.receiverMobile),r:e.t(p.value.receiverAddress),s:e.f(p.value.skus,((r,t,a)=>({a:r.image,b:e.t(r.name),c:e.t(r.attrsText),d:e.t(r.curPrice.toFixed(2)),e:e.t(r.quantity),f:r.id,g:`/pages/goods/goods?id=${r.spuId}`}))),t:p.value.orderState===e.unref(a.OrderState).DaiPingJia},(p.value.orderState,e.unref(a.OrderState).DaiPingJia,{}),{v:e.t(p.value.totalMoney),w:e.t(p.value.postFee),x:e.t(p.value.payMoney),y:e.t(n.id),z:e.o((r=>{return t=n.id,void e.index.setClipboardData({data:t});var t})),A:e.t(p.value.createTime),B:e.sr(i,"61f8bc7c-1",{k:"guessRef"}),C:(null==(m=e.unref(l))?void 0:m.bottom)+"px",D:p.value.orderState===e.unref(a.OrderState).DaiFuKuan},p.value.orderState===e.unref(a.OrderState).DaiFuKuan?{E:e.o(x),F:e.o((e=>{var r,t;return null==(t=null==(r=d.value)?void 0:r.open)?void 0:t.call(r)}))}:e.e({G:`/pagesOrder/create/create?orderId=${n.id}`,H:p.value.orderState===e.unref(a.OrderState).DaiShouHuo},p.value.orderState===e.unref(a.OrderState).DaiShouHuo?{I:e.o(D)}:{},{J:p.value.orderState===e.unref(a.OrderState).DaiPingJia},(p.value.orderState,e.unref(a.OrderState).DaiPingJia,{}),{K:p.value.orderState>=e.unref(a.OrderState).DaiPingJia},p.value.orderState>=e.unref(a.OrderState).DaiPingJia?{L:e.o(h)}:{}),{M:(null==(O=e.unref(l))?void 0:O.bottom)+"px"}):e.e({N:y.value},(y.value,{})),{O:e.o(((...r)=>e.unref(s)&&e.unref(s)(...r))),P:e.f(c.value,((r,t,a)=>({a:e.t(r),b:r===f.value?1:"",c:r,d:e.o((e=>f.value=r),r)}))),Q:e.o((e=>{var r,t;return null==(t=null==(r=d.value)?void 0:r.close)?void 0:t.call(r)})),R:e.sr(d,"61f8bc7c-3",{k:"popup"}),S:e.p({type:"bottom","background-color":"#fff"})})}}});wx.createPage(n);
