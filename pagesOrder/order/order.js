"use strict";const e=require("../../common/vendor.js"),r=require("../../services/order.js"),d=require("../../stores/modules/address.js");require("../../utils/http.js"),require("../../stores/index.js"),require("../../stores/modules/member.js");const s=e.defineComponent({__name:"order",props:{skuId:null,count:null,addressId:null,orderId:null},setup(s){const t=s,{safeAreaInsets:u}=e.index.getSystemInfoSync(),l=e.ref(),o=e.ref(""),a=e.ref([{type:1,text:"时间不限 (周一至周日)"},{type:2,text:"工作日送 (周一至周五)"},{type:3,text:"周末配送 (周六至周日)"}]),i=e.ref(0),n=e.computed((()=>a.value[i.value])),v=e=>{i.value=e.detail.value},c=d.userAddressStore(),p=e.computed((()=>{var e;return c.selectAddress||(null==(e=l.value)?void 0:e.userAddresses.find((e=>e.isDefault)))})),m=async()=>{var d,s;if(!(null==(d=p.value)?void 0:d.id))return e.index.showToast({title:"请选择地址",icon:"error"});const t=await r.postMemberOrderService({addressId:null==(s=p.value)?void 0:s.id,buyerMessage:o.value,deliveryTimeType:n.value.type,goods:l.value.goods.map((e=>({count:e.count,skuId:e.skuId}))),payChannel:2,payType:1});e.index.redirectTo({url:`/pagesOrder/detaile/detaile?id=${t.result.id}`})};return e.onLoad((()=>{(async()=>{if(t.skuId&&t.count&&t.addressId){const e=await r.getMemberOrderPreNowService({skuId:t.skuId,count:t.count,addressId:t.addressId});l.value=e.result}else if(t.orderId){const e=await r.getMemberOrderRepurchaseByIdService(t.orderId);l.value=e.result}else{const e=await r.getOrderProService();l.value=e.result}})()})),(r,d)=>{var s,t,i,c,f,y,I,g,x,b,k,j;return e.e({a:null==(s=l.value)?void 0:s.userAddresses},(null==(t=l.value)?void 0:t.userAddresses)?{b:e.t(null==(i=e.unref(p))?void 0:i.receiver),c:e.t(null==(c=e.unref(p))?void 0:c.contact),d:e.t(null==(f=e.unref(p))?void 0:f.fullLocation),e:e.t(null==(y=e.unref(p))?void 0:y.address)}:{},{f:e.f(null==(I=l.value)?void 0:I.goods,((r,d,s)=>({a:r.picture,b:e.t(r.name),c:e.t(r.attrsText),d:e.t(r.payPrice),e:e.t(r.price),f:e.t(r.count),g:r.skuId,h:`/pages/goods/goods?id=${r.id}`}))),g:e.t(e.unref(n).text),h:a.value,i:e.o(v),j:o.value,k:e.o((e=>o.value=e.detail.value)),l:e.t(null==(g=l.value)?void 0:g.summary.totalPrice.toFixed(2)),m:e.t(null==(x=l.value)?void 0:x.summary.postFee),n:e.t(null==(b=l.value)?void 0:b.summary.totalPayPrice.toFixed(2)),o:(null==(k=e.unref(p))?void 0:k.id)?"":1,p:e.o(m),q:(null==(j=e.unref(u))?void 0:j.bottom)+"px"})}}});wx.createPage(s);
